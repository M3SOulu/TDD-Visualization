<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Zorro Episode Visualization</title>
    <style>
      .axis path,
      .axis line {
        fill: none;
        stroke: red;
        shape-rendering: crispEdges;
        };
        .axis text {
          font-family: sans-serif;
          font-size: 11px;
        };
    </style>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="d3.legend.js"></script>
  </head>
  <body>
    <script type="text/javascript">

        var informations = [["Data Coverage: 54%",1],["Number of actions: 65",2],["Time Taken: 122",3],["Passing Tests: 2",4],["Failing Tests: 0",5]];
        
        //Initializing needed variablews for UI, like paddings and measures for SVGs
        var svgHeigth = 400;
        var svgWidth = 1000;
        var padding = 30;
        var previousWidth = 0;
        var barPadding = 5;
        var totalWidth = 0;
        
        //Initializing needed variables, like scales,axises and svgs.
        var svg = d3.select("body")
            .append("svg")
            .attr("width", svgWidth)
            .attr("height", svgHeigth);       
        var svgInfo = d3.select("body")
            .append("svg")
            .attr("width", svgWidth - 300)
            .attr("height", svgHeigth);        
        var legend = d3.select("body")
            .append("svg")
            .attr("width", svgWidth - 500)
            .attr("height", svgHeigth);        
        var xScale = d3.scale.linear()
            .domain([0,240])
            .range([5,965]);        
        var yScale = d3.scale.linear()
            .domain([100,0])
            .range([0, 360]);        
        var xAxis =  d3.svg.axis()
            .scale(xScale)
            .orient("bottom")
            .ticks(20);        
        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left")
            .ticks(20);
    
        //Creating new data format to being able to parse the data.
        d3.csv("bar-data.csv", function(error, data){
          data.forEach(function(d) {
            d.duration = d.Duration / 6;
            d.action = d.Action;
          });
          
        //creating the first SVG . The "g" element is a container used to group other SVG elements.
        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(25," + (svgHeigth - padding + 5 ) + ")")
          .call(xAxis);
        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + padding + ",14)")
          .call(yAxis);
        svg.selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          //setting starting point in the x-axis
          .attr("x", function(d,i) {
             /* if(i===0)
              {
              totalWidth = totalWidth + d.duration;
              return 30.5;
              }
              else
              {
                  totalWidth = totalWidth + d.duration + barPadding;*/
                  return 30.5 + totalWidth;
            //  }
          })
          //setting starting point in the y-axis
          .attr("y", function(d) {
            return svgHeigth -d.duration - 25;
          })
          //setting width of the bar
          .attr("width", function(d)
          {
              return d.duration; 
          })
          //setting height of the bar
          .attr("height", function(d,i) {
              return d.duration;
          })
          //setting colour of the bar
          .attr("fill", function(d) {
            if (d.action === "testLast")
              {
                color = "rgb(204,0,0)";
                return "rgb(204, 0, 0)";
              }
              else if(d.action === "testFirst")
                {
                  color = "rgb(0, 204, 0)";
                  return "rgb(0, 204, 0)";
                }
                else if(d.action === "testAddition")
                  return "rgb(204, 0, 204)";
                else if(d.action === "regression")
                  return "rgb(204, 204, 0)";
                else if(d.action === "codeProduction")
                  return "rgb(204, 102, 0)";
                else
                  return "rgb(0, 0, 204)";
          })
          
          //Showing more information of specific bar (in future) when clicked.
          /*rect*/.on("click", function() {
            svgInfo.selectAll("text")
            .data(data)
            .enter()
            .append("text")
            .text(function(d) {
              return d.action;
            })
            .attr("y", function(d,i){
              return i*70;
            })
            .style("font-size","25px");
          });
          svg.selectAll("text")
          .data(data)
          .enter()
          .append("text")
          .text(function(d) {
            return d.action;
          })
          .attr("x", function(d, i) {
            return i * (w / dataset.length);
          })
          .attr("y", function(d) {
            return h - (d * 4);
          });
        
         // draw squares for the legend    
        legend.selectAll('rect')
            .data(data)
            .enter()
            .append("rect")
            //setting where legends square starts for legend in x-axis
            .attr("x", svgWidth - 965)
            //setting where legends square starts for legend in y-axis
            .attr("y", function(d) 
            {
                if (d.action === "testLast")
                    return 30;
                else if(d.action === "testFirst")
                    return 65;
                else if(d.action === "testAddition")
                    return 100;
                else if(d.action === "regression")
                    return 135;
                else if(d.action === "codeProduction")
                    return 170;
                else
                    return 205;
            })
            //setting width of the square in the legend
            .attr("width", 30)
            //setting height of the square in the legend
            .attr("height", 30)
            .style("fill", function(d) {
                if (d.action === "testLast")
                {
                    color = "rgb(204,0,0)";
                    return "rgb(204, 0, 0)";
                }
                else if(d.action === "testFirst")
                {
                    color = "rgb(0, 204, 0)";
                    return "rgb(0, 204, 0)";
                }
                else if(d.action === "testAddition")
                    return "rgb(204, 0, 204)";
                else if(d.action === "regression")
                    return "rgb(204, 204, 0)";
                else if(d.action === "codeProduction")
                    return "rgb(204, 102, 0)";
                else
                    return "rgb(0, 0, 204)";
                });
        // draw text for the legend       
        legend.selectAll('text')
            .data(data)
            .enter()
            .append("text")
            .text(function(d)
            {
                return d.action;
            })
            //setting where legends text starts for legend in x-axis
            .attr("x",100)
            //setting where legends text starts for legend in y-axis
            .attr("y", function(d) {
                if (d.action === "testLast")
                    return 50;
                else if(d.action === "testFirst")
                    return 85;
                else if(d.action === "testAddition")
                    return 120;
                else if(d.action === "regression")
                    return 155;
                else if(d.action === "codeProduction")
                    return 190;
                else
                    return 225;
                })
            .style("font-size","25px");
        });
    </script>
  </body>
</html>
